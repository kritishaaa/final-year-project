Perfect â€” now letâ€™s go **step by step** and explain the **flow of your system** based on your migrations. Iâ€™ll show how the tables connect, what data flows where, and how it aligns with your portals and algorithms.

---

# ğŸ“¦ Courier Management System â€” Flow Explanation

## 1ï¸âƒ£ `branches` Table

**Purpose:**
Stores branch information with coordinates.

**Fields of interest:**

* `latitude`, `longitude` â†’ used for **distance calculation** (Haversine formula for pricing).

**Flow:**

1. Customer selects `from_branch_id` and `to_branch_id` while creating a parcel.
2. System fetches branch coordinates â†’ calculates distance â†’ estimates price.

**Connected Tables:**

* `parcels` â†’ `from_branch_id`, `to_branch_id`
* `couriers` â†’ `branch_id` (assigned branch)

---

## 2ï¸âƒ£ `parcels` Table

**Purpose:**
Stores all parcel-related information (sender, recipient, weight, distance, price, status).

**Fields of interest:**

* `distance`, `price` â†’ **calculated by Algorithm 1 (Cost Estimator)**
* `status` â†’ tracks parcel state: `pending`, `in_transit`, `delivered`, `cancelled`.

**Flow:**

1. Customer creates parcel â†’ fills sender and recipient info + selects branches.
2. System calculates **distance** and **price**.
3. Admin can assign a courier.

**Connected Tables:**

* `branches` â†’ pickup and delivery branch IDs
* `parcel_assignments` â†’ links parcel to courier
* `parcel_tracks` â†’ tracks parcel status changes
* `parcel_payments` â†’ stores payment info

---

## 3ï¸âƒ£ `parcel_tracks` Table

**Purpose:**
Tracks parcel status updates over time.

**Fields:**

* `parcel_id` â†’ links to `parcels`
* `status` â†’ integer representing current state
* `date_created` â†’ timestamp of update

**Flow:**

1. Whenever parcel status changes (assigned, picked, delivered), a new entry is created here.
2. Helps **history tracking** for both customer and admin.

**Connected Tables:**

* `parcels` â†’ one-to-many relationship (1 parcel â†’ many track entries)

---

## 4ï¸âƒ£ `locations` Table

**Purpose:**
Stores optional geo-locations (branches, depots, or delivery points).

**Fields:**

* `latitude` & `longitude` â†’ can be used for mapping or **route optimization (Algorithm 2)**.

**Flow:**

* System may use this table to calculate courier routes or visualize delivery points.

**Connected Tables:**

* Could be linked to `parcels` or used internally in routing logic.

---

## 5ï¸âƒ£ `couriers` Table

**Purpose:**
Stores courier details.

**Fields:**

* `user_id` â†’ links to `users` table (role = courier)
* `branch_id` â†’ courier's base branch
* `active` â†’ whether courier is available

**Flow:**

1. Admin registers couriers.
2. When assigning a parcel, the system selects **active couriers** from relevant branch.
3. `courier_id` in `parcel_assignments` links parcels to courier.

**Connected Tables:**

* `parcel_assignments` â†’ courier handles parcels
* `users` â†’ authentication

---

## 6ï¸âƒ£ `parcel_assignments` Table

**Purpose:**
Manages **which courier is assigned to which parcel** and tracks delivery status.

**Fields:**

* `status` â†’ tracks parcel progress:

  * 0 = Pending
  * 1 = Assigned
  * 2 = Picked
  * 3 = Delivered
* `assigned_at`, `delivered_at` â†’ timestamps for events

**Flow:**

1. Admin assigns parcel â†’ `status = 1` (Assigned)
2. Courier picks up parcel â†’ `status = 2`
3. Courier delivers parcel â†’ `status = 3` â†’ triggers `parcel_tracks` update

**Connected Tables:**

* `parcels` â†’ parcel being delivered
* `couriers` â†’ assigned delivery person

**Algorithm 2 connection:**

* The courier dashboard can fetch all **assigned parcels** and calculate **optimized delivery route** using `parcel_assignments` + `parcels.recipient_address/coordinates`.

---

## 7ï¸âƒ£ `parcel_payments` Table

**Purpose:**
Stores payment info for each parcel.

**Fields:**

* `payment_method` â†’ cash, card, online
* `amount` â†’ total cost
* `paid` â†’ boolean

**Flow:**

1. Customer pays upon parcel creation or delivery.
2. Payment is logged here.
3. `price` from `parcels` is referenced to validate the payment amount.

**Connected Tables:**

* `parcels` â†’ payment is linked to a specific parcel

---

# ğŸ”— Data Flow Summary

### Customer Portal

1. Select branches, enter parcel info â†’ system calculates distance & price â†’ stored in `parcels`.
2. Payment (optional) â†’ stored in `parcel_payments`.
3. Parcel status tracked in `parcel_tracks`.

### Admin Portal

1. View parcels â†’ assign courier â†’ creates entry in `parcel_assignments`.
2. Can view parcel route, payments, and tracking history.

### Courier Portal

1. View assigned parcels (`parcel_assignments`) â†’ fetch recipient coordinates â†’ run **Algorithm 2 (Route Optimization)**.
2. Update delivery status â†’ adds entry in `parcel_tracks`.

---

# ğŸ§® Algorithm Connections to Tables

| Algorithm                             | Table(s)                                                 | Data Flow                                                                            |
| ------------------------------------- | -------------------------------------------------------- | ------------------------------------------------------------------------------------ |
| Distance-Based Cost Estimator         | `parcels`, `branches`                                    | Uses branch coordinates & parcel weight â†’ updates `distance` & `price`               |
| Route Optimization (Nearest Neighbor) | `parcels`, `couriers`, `parcel_assignments`, `locations` | Fetch assigned parcels & courier location â†’ calculates optimal sequence for delivery |

---

If you want, I can **draw a visual flow diagram** showing **all these tables, their relationships, and how data flows from customer â†’ admin â†’ courier** â€” it will make your documentation extremely clear.

Do you want me to do that next?
